@model LuyenThiTracNghiem.Models.tblPayment

@{
    Layout = "_Layout";
}

<div class="recharge-container">
    <div class="recharge-card">
        <div class="card-header">
            <h3 class="header-title">Nạp tiền vào tài khoản</h3>
            <p class="header-subtitle">Nhanh chóng - Bảo mật - Tiện lợi</p>
        </div>

        <div class="card-body">
            <form method="get" asp-action="CreatePaymentUrl" id="paymentForm">
                <div class="form-section">
                    <label class="section-label">Chọn số tiền nạp</label>
                    <div class="amount-grid">
                        <button type="button" class="amount-btn" data-amount="10000">
                            <span class="amount">10.000</span>
                            <span class="currency">VNĐ</span>
                        </button>
                        <button type="button" class="amount-btn" data-amount="50000">
                            <span class="amount">50.000</span>
                            <span class="currency">VNĐ</span>
                        </button>
                        <button type="button" class="amount-btn" data-amount="100000">
                            <span class="amount">100.000</span>
                            <span class="currency">VNĐ</span>
                        </button>
                        <button type="button" class="amount-btn" data-amount="200000">
                            <span class="amount">200.000</span>
                            <span class="currency">VNĐ</span>
                        </button>
                        <button type="button" class="amount-btn" data-amount="500000">
                            <span class="amount">500.000</span>
                            <span class="currency">VNĐ</span>
                        </button>
                        <button type="button" class="amount-btn" data-amount="1000000">
                            <span class="amount">1.000.000</span>
                            <span class="currency">VNĐ</span>
                        </button>
                    </div>
                    
                    <div class="custom-amount">
                        <label class="form-label">Hoặc nhập số tiền khác</label>
                        <div class="input-group">
                            <input name="amount" id="amountInput" class="form-control custom-input" 
                                   type="number" min="10000" value="10000" required />
                            <span class="input-group-text">VNĐ</span>
                        </div>
                        <div class="form-text">Số tiền tối thiểu: 10.000 VNĐ</div>
                    </div>
                </div>

                <div class="form-section">
                    <label class="section-label">Phương thức thanh toán</label>
                    <div class="payment-methods">
                        <div class="payment-method active">
                            <div class="method-icon">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <div class="method-info">
                                <div class="method-name">VNPAY QR</div>
                                <div class="method-desc">Thanh toán qua ứng dụng ngân hàng</div>
                            </div>
                            <div class="method-check">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="paymentMethod" value="VNPAY" />
                </div>

                <div class="order-summary">
                    <div class="summary-item">
                        <span>Số tiền nạp:</span>
                        <span id="summaryAmount">10.000 VNĐ</span>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-credit-card me-2"></i>
                    <span class="btn-text">Nạp tiền ngay</span>
                    <div class="btn-loader">
                        <div class="spinner"></div>
                    </div>
                </button>
            </form>
        </div>
    </div>
</div>

<link rel="stylesheet" href="~/assets/css/payment-index.css" asp-append-version="true" />

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const amountButtons = document.querySelectorAll('.amount-btn');
        const amountInput = document.getElementById('amountInput');
        const summaryAmount = document.getElementById('summaryAmount');
        const totalAmount = document.getElementById('totalAmount');
        const submitBtn = document.querySelector('.submit-btn');
        const paymentForm = document.getElementById('paymentForm');

        // Format số tiền
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount) + ' VNĐ';
        }

        function updateSummary() {
            const amount = parseInt(amountInput.value) || 0;
            summaryAmount.textContent = formatCurrency(amount);
            totalAmount.textContent = formatCurrency(amount);
        }

        amountButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                amountButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const amount = this.dataset.amount;
                amountInput.value = amount;
                updateSummary();
            });
        });

        amountInput.addEventListener('input', function() {
            amountButtons.forEach(b => b.classList.remove('active'));
            updateSummary();
        });

        paymentForm.addEventListener('submit', function(e) {
            const amount = parseInt(amountInput.value);
            
            if (isNaN(amount) || amount < 10000) {
                e.preventDefault();
                showAlert('Số tiền nạp tối thiểu là 10.000 VNĐ', 'error');
                amountInput.focus();
                return;
            }

            e.preventDefault();
            
            submitBtn.classList.add('loading');
            
            setTimeout(() => {
                const confirmed = confirm(`Xác nhận nạp ${formatCurrency(amount)} vào tài khoản?`);
                if (confirmed) {
                    paymentForm.submit();
                } else {
                    submitBtn.classList.remove('loading');
                }
            }, 500);
        });

        updateSummary();

        amountButtons[0].classList.add('active');
    });

    function showAlert(message, type) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type === 'error' ? 'danger' : 'success'} alert-dismissible fade show`;
        alertDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            animation: slideInRight 0.3s ease-out;
        `;
        
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(alertDiv);
        
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    }
</script>